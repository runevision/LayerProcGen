<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LayerProcGen: Planning at Scale</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="LayerProcGenLogoSmall.png"/></td>
  <td id="projectalign">
   <div id="projectname">LayerProcGen<span id="projectnumber">&#160;v0.1.0</span>
   </div>
   <div id="projectbrief">Layer-based infinite procedural generation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_PlanningAtScale.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Planning at Scale</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md2"></a> There are many ways to do procedural generation, but two broad approaches that can be contrasted are <b>the functional approach</b> and <b>the planning approach</b>.</p>
<p><b>The functional approach</b></p>
<ul>
<li>Content is a spatially local function.</li>
<li>No context of surroundings.</li>
<li>Common in “open world” procedural games like Minecraft and No Man’s Sky.</li>
</ul>
<p><img src="Functional.png" alt="" class="inline"/>     <img src="FunctionalChunkWithoutContext.png" alt="" class="inline"/>    </p>
<p><b>The planning approach</b></p>
<ul>
<li>Generation is top-down.</li>
<li>Intent behind placement of items, and how things are connected.</li>
<li>Common in procedural games with finite spaces, such as rogue-likes.</li>
</ul>
<p><img src="Planning.png" alt="" class="inline"/>     <img src="PlanningRoguelike.png" alt="" class="inline"/>    </p>
<h1>Limitations of the functional approach</h1>
<p>The specifics of spaces cannot be planned with intent using the functional approach. It doesn’t know:</p>
<ul>
<li>If a cave is connected to the surface.</li>
<li>If a tall cliff is reachable.</li>
</ul>
<p><img src="FunctionalLimitationCaves.png" alt="" class="inline"/>     <img src="FunctionalLimitationTooWideGap.png" alt="" class="inline"/>    </p>
<p>Games work around this in a few ways:</p>
<ul>
<li>By giving the player generous abilities to reach any point.</li>
<li>By only placing progression-critical objectives at special trivially reachable spots.</li>
</ul>
<p>Essentially the functional approach necessitates embracing <em>sandbox gameplay</em>.</p>
<h1>The planning approach in infinite games</h1>
<p>There are not many, if any, open world (infinite) procedurally generated games using the planning approach at a large scale yet. There is a tendency that infinite games always use the functional approach and involve sandbox gameplay.</p>
<p>But should that have to be the case?</p>
<p>Using the planning approach in an infinite game is one of the things layer-based generation makes possible. And this allows having procedurally generated open-world games that don't necessarily revolve around sandbox gameplay.</p>
<p>Layer-based generation can have different layers that operate at different levels of abstraction. Chunks can have any size, so chunks in one layer can be orders of magnitude larger than chunks in another layer.</p>
<div class="image">
<img src="ClusterLayers.png" alt=""/>
<div class="caption">
Layers in The Cluster.</div></div>
    <p>Things that are possible:</p>
<ul>
<li>Road signs that point to distant locations.</li>
<li>Unlocking entire regions based on player progress.</li>
<li>Having NPCs talk about things at the other side of the continent.</li>
</ul>
<p>Top-down planning is what makes these things possible. It's hard to generalize how to do this, but the following is an example from an actual implementation.</p>
<div class="image">
<img src="ClusterRoadSigns.png" alt=""/>
<div class="caption">
Road signs in The Cluster.</div></div>
    <h1>Top-down planning example from The Cluster</h1>
<p>In the 2.5D platformer game The Cluster, the player must find and activate all artefacts in a region to be able to free that region. The artefacts can be found via exploration alone, but there are shrines at various locations where the player can get assistance. At those shrines, shrine spirits can locate the approximate location of the nearest artefact not yet found, which is marked in a circle on the player's map.</p>
<div class="image">
<img src="ClusterRevealedArtefactArea.gif" alt=""/>
<div class="caption">
Revealed artefact area in The Cluster.</div></div>
    <p>A MazeLayer with MazeChunks create sparse maze-like areas for the platformer gameplay. Each chunk creates an area of a size similar to one "stage" in a stage-based game, but there are potential connections at the top, bottom and sides to adjacent areas.</p>
<div class="image">
<img src="ClusterMazeLayer.png" alt=""/>
<div class="caption">
MazeChunks in The Cluster.</div></div>
    <div class="image">
<img src="ClusterTopDownMazeLayer.png" alt=""/>
<div class="caption">
All the currently generated MazeChunks.</div></div>
    <p>A RegionLayer with RegionChunks plan out regions in a big grid, each region encompassing around 50 areas, though some of them are simply solid ground. The RegionLayer plans the main paths through a region which connect a central village, gates to neighboring regions, and shrines at certain locations along the way. It also plans paths not shown on the player's map which lead to artefacts at hidden locations.</p>
<div class="image">
<img src="ClusterTopDownRegionLayer.png" alt=""/>
<div class="caption">
RegionsChunks in The Cluster. Every second cell in the grid corresponds to one MazeChunk.</div></div>
    <p>Every second cell in the RegionLayer grid corresponds to one MazeChunk area. In its generation code, a MazeChunk queries data from the RegionLayer about presence of connections to adjacent areas, presence of any special locations in the chunk (shrine, village, gate, artefact), and whether the area is above ground or underground. The MazeChunk generates an area according to those specifications.</p>
<p>The RegionLayer also has information about which of the four directions lead to nearby shrines, gates, or the village (which each have unique names). The MazeLayer uses this information to place road signs at relevant junctions in its own generated paths.</p>
<p>In the debug visualization above, each region has a different debug color. You may notice that there isn't a one-to-one relationship between regions and RegionChunks. The regions are generated according to the "owned within bounds" principle described on the page about <a class="el" href="md_Patterns.html">software patterns for layers</a>. The area coverage of regions is generated by an even larger-scale layer called the WorldLayer, whereas the RegionLayer plans the content of individual regions.</p>
<h1>Building up from the bottom</h1>
<p>While top-down planning (encoded in the generation processes of a game) is ultimately the way to generate a game world that feels planned at scale with intent, it can be a daunting prospect when starting from scratch. It may be easier to start planning and implementing the smaller scale layers first.</p>
<p>In The Cluster, the MazeLayer was implemented before the RegionLayer was even conceived of. The initial focus was just to make traversal and exploration in each individual area satisfying. As the game evolved and took shape, the RegionLayer was added, and the MazeChunk code was altered to take specifications from that RegionLayer.</p>
<p>In other words, it can be a good strategy to start with implementing gameplay and features that are focused locally around the player. Once that is working, if the game feels like it could benefit from being interconnected at a larger scale, or having a larger plan or sense of purpose, that can be a good time to add a layer that plan such things out at a larger scope. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0 </li>
  </ul>
</div>
</body>
</html>
