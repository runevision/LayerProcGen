<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LayerProcGen: Software Patterns for Layers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="LayerProcGenLogoSmall.png"/></td>
  <td id="projectalign">
   <div id="projectname">LayerProcGen<span id="projectnumber">&#160;v0.1.0</span>
   </div>
   <div id="projectbrief">Layer-based infinite procedural generation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_Patterns.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Software Patterns for Layers</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md8"></a> This page covers various aspects of using data layers which are not encoded as features in the framework but are just different ways of using of it.</p>
<h1>Data overlapping vs owned in bounds</h1>
<p>Careful consideration is needed when designing the API of a layer which other layers use to request data within given bounds.</p>
<p>"All data in the given bounds" can imply different things depending on the intended usage.</p>
<p>Consider a game which has generated spline roads with two needs:</p>
<ul>
<li>The terrain must be flattened along the roads.</li>
<li>Decorations such as lamp posts must be added along the roads.</li>
</ul>
<h2>Overlapping bounds</h2>
<p>For a given chunk to perform terrain deformation for roads within its own bounds, it needs spline data for all roads overlapping those bounds:</p>
<div class="fragment"><div class="line">GetRoadsOverlappingBounds(...)</div>
</div><!-- fragment --><p>If a road spline overlaps multiple chunks of the layer that performs the terrain deformation, all the overlapping chunks must process that road in order to get seamless results across chunk boundaries.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> GetRoadsOverlappingBounds(ILC q, List&lt;Road&gt; outRoads, GridBounds bounds) {</div>
<div class="line">    HandleChunksInBounds(q, bounds, 0, chunk =&gt; {</div>
<div class="line">        <span class="keywordflow">foreach</span> (var road <span class="keywordflow">in</span> chunk.roads)</div>
<div class="line">            if (bounds.Overlaps(road.bounds))</div>
<div class="line">                outRoads.Add(road);</div>
<div class="line">    });</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Owned within bounds</h2>
<p>For a given chunk to perform road decoration (placement of lamp posts) for roads within its own bounds, it needs only spline data for roads that are "owned" within those bounds.</p>
<div class="fragment"><div class="line">GetPathsOwnedWithinBounds(...)</div>
</div><!-- fragment --><p>If a road spline overlaps multiple chunks of the layer that performs road decoration, only one of the chunks must process the road in order for the same road to not get double decorations.</p>
<p>To resolve this deterministically, the layer providing the road spline data must define an ownership “anchor point” for each road spline (for example the center of the road spline bounds) and only return road splines whose anchors are within the requested bounds.</p>
<p>This approach works without the road spline providing layer needing to know anything about the chunk sizes of the layers requesting the data.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> GetRoadsOwnedWithinBounds(ILC q, List&lt;Road&gt; outRoads, GridBounds bounds) {</div>
<div class="line">    HandleChunksInBounds(q, bounds, 0, chunk =&gt; {</div>
<div class="line">        <span class="keywordflow">foreach</span> (var road <span class="keywordflow">in</span> chunk.roads)</div>
<div class="line">            if (bounds.Contains(road.bounds.center))</div>
<div class="line">                outRoads.Add(road);</div>
<div class="line">    });</div>
<div class="line">}</div>
</div><!-- fragment --><h1>Layer types</h1>
<p>This documentation is generally assuming layers to be generation layers, but other patterns for using layers are possible, although probably only suitable for advanced users.</p>
<h2>Generation layer</h2>
<p>The standard pattern for a data layer is that it generates its own data in the Create method of each chunk.</p>
<p>The chunk may optionally query data from other layers to use as input for its generation.</p>
<h2>Canvas layer</h2>
<p>In this pattern a layer has chunks with certain data structures for data storage, but the chunks don't generate any data. Instead other layers can push data to the layer, and the layer will figure out which chunk to store it in. The name "canvas layer" is used since the layer is a "blank canvas" that other layers can "paint on".</p>
<p>Example usages:</p>
<ul>
<li>A layer storing spatial debug messages with associated positions in the world.</li>
<li>A layer storing data for instantiating objects/Prefabs.</li>
</ul>
<p>In general, potential use cases are when it's beneficial to have a single layer responsible for storing all data of a given type, but many layers can create data of that type.</p>
<p>Something needs to be responsible for using that data - a canvas "user". This can be a separate layer, or it can be a higher internal layer level of the canvas itself. In the latter case, be careful to specify levels of the layer dependencies correctly.</p>
<p>Things get complex if the canvas "user" requires the canvas data to be fully "filled in" within specific bounds. In this case the canvas "user" must specify layer dependencies on all the layers that write into the canvas layer.</p>
<p>It's also worth designing the canvas interface with these things in mind:</p>
<ul>
<li>Each data entry has a unique id (not just based on position) and different entries can't overwrite each other.</li>
<li>A layer whose chunks push data entries to a canvas layer will also take care of requesting those entries removed again when those chunks are destroyed. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0 </li>
  </ul>
</div>
</body>
</html>
